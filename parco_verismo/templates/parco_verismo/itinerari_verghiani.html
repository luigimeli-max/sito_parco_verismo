{% extends 'parco_verismo/base.html' %}
{% load static i18n %}

{% block title %}{% trans 'Parco Letterario Giovanni Verga Luigi Capuana - Itinerari Verghiani' %}{% endblock %}

{% block meta_description %}{% trans 'Itinerari Verghiani - Scopri i luoghi delle opere di Giovanni Verga attraverso percorsi letterari nel cuore della Sicilia.' %}{% endblock %}
{% block meta_keywords %}Itinerari Verghiani, Giovanni Verga, Verismo, Sicilia, percorsi letterari{% endblock %}

{% block extra_head %}
    <!-- Stili specifici per itinerari -->
    <link rel="stylesheet" href="{% static 'css/itinerari.css' %}" />
    <link rel="stylesheet" href="{% static 'css/map_routes.css' %}" />
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
{% endblock %}

{% block hero_section %}
    <!-- Hero Section -->
    <section class="hero-verghiani d-flex align-items-center justify-content-center text-center mb-5">
      <div class="hero-content px-3">
        <h1 class="display-3 fw-bold text-white">{% trans 'Itinerari Verghiani' %}</h1>
      </div>
    </section>
{% endblock %}

{% block content %}
    <div class="container-xl my-5">
      {% if itinerari %}
      <div class="text-center mb-5">
        <h2 class="pages-section-title h2 fw-bold">{% trans 'Mappa Itinerari Verghiani' %}</h2>
        <p class="lead text-secondary" style="max-width: 600px; margin: 0 auto;">{% trans 'Scopri i luoghi di interesse sulla mappa interattiva' %}</p>
      </div>

      <div class="map-layout">
        <!-- Sidebar Itinerari -->
        <div class="map-sidebar">
          <div class="map-sidebar-header">
            <h4><i class="bi bi-signpost-2 me-2"></i>{% trans 'Percorsi Disponibili' %}</h4>
          </div>
          <div class="map-sidebar-content">
            {% for data in itinerari_data %}
            <div class="itinerario-card" data-itinerario-id="{{ data.obj.id }}">
              <script type="application/json" class="itinerario-data">{{ data.itinerario_json|safe }}</script>
              <div class="itinerario-card-header">
                <div class="itinerario-header-text">
                  <h3 class="itinerario-title">{{ data.obj.titolo }}</h3>
                  <div class="itinerario-meta-mini">
                    <span class="badge badge-tappe">
                      <i class="bi bi-geo-alt"></i>
                      {{ data.obj.get_numero_tappe }} {% trans 'tappe' %}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="itinerario-card-body">
                <p class="itinerario-description">{{ data.obj.descrizione|truncatewords:15 }}</p>
                
                <div class="itinerario-meta">
                  <div class="meta-item">
                    <i class="bi bi-clock"></i>
                    <span>{{ data.obj.durata_stimata|default:'Non specificata' }}</span>
                  </div>
                  <div class="meta-item">
                    <i class="bi bi-signal"></i>
                    <span>{{ data.obj.get_difficolta_display }}</span>
                  </div>
                </div>
              </div>
              
              <div class="itinerario-card-footer">
                <div class="d-flex gap-2">
                  <button class="btn btn-show-route btn-sm flex-fill">
                    <i class="bi bi-geo-alt-fill me-1"></i>
                    {% trans 'Mostra sulla mappa' %}
                  </button>
                  <button class="btn btn-info-itinerario btn-sm">
                    <i class="bi bi-info-circle"></i>
                  </button>
                </div>
              </div>
            </div>
            {% endfor %}
            
            <div class="mt-3">
              <button class="btn btn-secondary btn-sm w-100" id="resetMapView">
                <i class="bi bi-arrow-clockwise me-2"></i>
                {% trans 'Reset vista mappa' %}
              </button>
            </div>
          </div>
        </div>
        
        <!-- Mappa -->
        <div class="map-main">
          <div id="map" class="map-container rounded shadow"></div>
        </div>
      </div>
      
      <!-- Modale Dettagli Tappa -->
      <div class="modal fade" id="tappaModal" tabindex="-1" aria-labelledby="tappaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #4A6741 0%, #3D5535 100%); color: white;">
              <h5 class="modal-title" id="tappaModalLabel">
                <i class="bi bi-geo-alt-fill me-2"></i>
                <span id="tappaModalTitolo"></span>
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tappaModalBody" style="min-height: 200px; max-height: 60vh; overflow-y: auto;">
              <!-- Contenuto dinamico -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="bi bi-x-circle me-1"></i>
                {% trans 'Chiudi' %}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modale Info Itinerario -->
      <div class="modal fade" id="itinerarioInfoModal" tabindex="-1" aria-labelledby="itinerarioInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #4A6741 0%, #3D5535 100%); color: white;">
              <h5 class="modal-title" id="itinerarioInfoModalLabel">
                <i class="bi bi-signpost-2 me-2"></i>
                <span id="itinerarioInfoModalTitolo"></span>
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="itinerarioInfoModalBody" style="max-height: 70vh; overflow-y: auto;">
              <!-- Contenuto dinamico -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="bi bi-x-circle me-1"></i>
                {% trans 'Chiudi' %}
              </button>
            </div>
          </div>
        </div>
      </div>

      {% else %}
      <div class="alert alert-info text-center">
        <h5>{% trans 'Nessun itinerario disponibile' %}</h5>
        <p>{% trans 'Al momento non ci sono itinerari verghiani disponibili. Torna presto per scoprire i percorsi!' %}</p>
      </div>
      {% endif %}
    </div>
{% endblock %}

{% block extra_scripts %}
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <!-- Map Scripts -->
    <script src="{% static 'js/itinerari-verghiani.js' %}"></script>
{% endblock %}

