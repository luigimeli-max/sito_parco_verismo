{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" data-theme="verismo">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CPRYW1SYB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1CPRYW1SYB');
    </script>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="{% block meta_description %}{% trans 'Parco Letterario Giovanni Verga Luigi Capuana - Un viaggio nella letteratura verista siciliana attraverso i luoghi di Verga e Capuana' %}{% endblock %}">
    <meta name="keywords"
        content="{% block meta_keywords %}parco letterario, verismo, Giovanni Verga, Luigi Capuana, Sicilia, letteratura, Vizzini, Mineo, Licodia Eubea{% endblock %}">
    <meta name="author" content="Parco Letterario Giovanni Verga e Luigi Capuana">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://parcovergacapuana.it{{ request.path }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{% block og_title %}{% trans 'Parco Letterario Giovanni Verga e Luigi Capuana' %}{% endblock %}">
    <meta property="og:description"
        content="{% block og_description %}{% trans 'Scopri il Parco Letterario Giovanni Verga e Luigi Capuana: itinerari, eventi e cultura nei luoghi di Verga e Capuana' %}{% endblock %}">
    <meta property="og:image"
        content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-header.png' %}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    <meta property="og:site_name" content="Parco Letterario Giovanni Verga e Luigi Capuana">
    <meta property="og:locale" content="{% if LANGUAGE_CODE == 'it' %}it_IT{% else %}en_US{% endif %}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ request.build_absolute_uri }}">
    <meta name="twitter:title" content="{% block twitter_title %}{% trans 'Parco Letterario Giovanni Verga e Luigi Capuana' %}{% endblock %}">
    <meta name="twitter:description"
        content="{% block twitter_description %}{% trans 'Scopri il Parco Letterario Giovanni Verga e Luigi Capuana in Sicilia' %}{% endblock %}">
    <meta name="twitter:image"
        content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-header.png' %}{% endblock %}">

    <!-- Structured Data - Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "@id": "{{ request.scheme }}://{{ request.get_host }}/#organization",
      "name": "Parco Letterario Giovanni Verga e Luigi Capuana",
      "url": "{{ request.scheme }}://{{ request.get_host }}/",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-header.png' %}",
        "width": "2000",
        "height": "2000"
      },
      "sameAs": [
        "https://www.facebook.com/parcoletterariovergacapuana",
        "https://www.instagram.com/parcovergacapuana"
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "@id": "{{ request.scheme }}://{{ request.get_host }}/#website",
      "url": "{{ request.scheme }}://{{ request.get_host }}/",
      "name": "Parco Letterario Giovanni Verga e Luigi Capuana",
      "publisher": {
        "@id": "{{ request.scheme }}://{{ request.get_host }}/#organization"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ request.scheme }}://{{ request.get_host }}/search/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "{% block schema_type %}TouristAttraction{% endblock %}",
      "name": "Parco Letterario Giovanni Verga e Luigi Capuana",
      "description": "{% trans 'Parco letterario dedicato alla scoperta del Verismo siciliano attraverso i luoghi di Giovanni Verga e Luigi Capuana' %}",
      "url": "{{ request.scheme }}://{{ request.get_host }}{{ request.path }}",
      "address": {
        "@type": "PostalAddress",
        "addressRegion": "Sicilia",
        "addressCountry": "IT"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "37.1667",
        "longitude": "14.7500"
      }{% block schema_extra %}{% endblock %}
    }
    </script>

    <title>{% block title %}{% trans 'Parco Letterario Giovanni Verga e Luigi Capuana' %}{% endblock %}</title>

    <!-- Favicon & Site Identity -->
    <link rel="icon" href="{{ request.scheme }}://{{ request.get_host }}{% static 'favicon.ico' %}" sizes="any">
    <link rel="icon" type="image/png" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/favicon-48.png' %}" sizes="48x48">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/favicon-32.png' %}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-192.png' %}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-512.png' %}">
    <link rel="apple-touch-icon" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-192.png' %}">
    <link rel="mask-icon" href="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-512.png' %}" color="#4A6741">
    <meta name="theme-color" content="#4A6741">
    <meta name="msapplication-TileColor" content="#4A6741">
    <meta name="msapplication-TileImage" content="{{ request.scheme }}://{{ request.get_host }}{% static 'assets/img/logo-192.png' %}">
    <meta name="apple-mobile-web-app-title" content="Parco Verismo">
    <meta name="application-name" content="Parco Verismo">

    <!-- Bootstrap CSS locale -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

    <!-- Local fonts: TeX Gyre Termes and Perandory -->
    <link rel="stylesheet" href="{% static 'fonts/perandory/perandory.css' %}?v=20251218">
    <link rel="stylesheet" href="{% static 'fonts/tex-gyre-termes/tex-gyre-termes.css' %}?v=20251218">

    <!-- Bootstrap Icons locale -->
    <link rel="stylesheet" href="{% static 'fonts/bootstrap-icons/bootstrap-icons.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <!-- Fonts helper (h1/h2 rules) -->
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/cookie_banner.css' %}">

    <!-- AOS (Animate On Scroll) CSS -->
    <link rel="stylesheet" href="{% static 'css/aos.css' %}" />

    {% block extra_head %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-to-main visually-hidden-focusable">
        {% trans 'Salta al contenuto principale' %}
    </a>

    {% include 'parco_verismo/navbar.html' %}

    {% block hero_section %}{% endblock %}

    <main class="page-content" id="main-content" role="main" aria-label="{% trans 'Contenuto principale' %}">
        {% block content %}{% endblock %}
    </main>

    {% include 'parco_verismo/components/footer.html' %}
    {% include 'parco_verismo/components/cookie_banner.html' %}

    <!-- Bootstrap JS -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

    <!-- Google Analytics Configuration -->
    {% if GA_MEASUREMENT_ID %}
    <script>
        window.GA_MEASUREMENT_ID = "{{ GA_MEASUREMENT_ID }}";
    </script>
    {% endif %}

    <!-- Cookie Banner Script -->
    <script src="{% static 'js/cookie_banner.js' %}"></script>

    <!-- Custom Scripts -->
    <script>
        (function () {
            function setLogoWhite(logo) {
                try {
                    if (!logo || !logo.src) return;
                    if (logo.src.includes('logo-header.png')) {
                        logo.src = logo.src.replace('logo-header.png', 'logo-header-white.png');
                    }
                } catch (e) { }
            }

            function setLogoDark(logo) {
                try {
                    if (!logo || !logo.src) return;
                    if (logo.src.includes('logo-header-white.png')) {
                        logo.src = logo.src.replace('logo-header-white.png', 'logo-header.png');
                    }
                } catch (e) { }
            }

            document.addEventListener('DOMContentLoaded', function () {
                const navbar = document.getElementById('mainNav');
                const logo = navbar ? navbar.querySelector('.logo-header') : null;

                if (!navbar) return;

                // Controlla se siamo in una pagina con navbar-dark-pages (tutte tranne homepage)
                if (navbar.classList.contains('navbar-dark-pages')) {
                    // Pagine normali: navbar sempre solida con logo scuro
                    navbar.classList.add('navbar-scrolled');
                    navbar.classList.add('navbar-light');
                    navbar.classList.remove('navbar-dark');
                    setLogoDark(logo);
                    return; // Non serve altro per queste pagine
                }

                // Solo per homepage: cerca hero e usa IntersectionObserver
                const hero = document.querySelector('header, .pages-hero, .hp-hero, .hero-section, .cts-hero');

                if (hero) {
                    // Start transparent
                    navbar.classList.remove('navbar-scrolled');
                    navbar.classList.remove('navbar-light');
                    navbar.classList.add('navbar-dark');
                    setLogoWhite(logo);

                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                // hero visible -> transparent + white logo
                                navbar.classList.remove('navbar-scrolled');
                                navbar.classList.remove('navbar-light');
                                navbar.classList.add('navbar-dark');
                                setLogoWhite(logo);
                            } else {
                                // hero out of view -> solid + dark logo
                                navbar.classList.add('navbar-scrolled');
                                navbar.classList.remove('navbar-dark');
                                navbar.classList.add('navbar-light');
                                setLogoDark(logo);
                            }
                        });
                    }, { root: null, threshold: 0, rootMargin: '-60px 0px 0px 0px' });

                    observer.observe(hero);
                }

                // Backup: listen to scroll in case observer isn't supported
                window.addEventListener('scroll', function () {
                    if (!navbar) return;
                    if (window.scrollY > 50) {
                        navbar.classList.add('navbar-scrolled');
                        if (!navbar.classList.contains('navbar-dark-pages')) {
                            navbar.classList.remove('navbar-dark');
                            navbar.classList.add('navbar-light');
                        }
                        setLogoDark(logo);
                    } else {
                        // Only remove scrolled if we either had a hero or the navbar isn't the dark-pages variant
                        if (hero || !navbar.classList.contains('navbar-dark-pages')) {
                            navbar.classList.remove('navbar-scrolled');
                            navbar.classList.remove('navbar-light');
                            navbar.classList.add('navbar-dark');
                            setLogoWhite(logo);
                        }
                    }
                }, { passive: true });
            });
        })();

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (!href || href === '#' || href.length <= 1) {
                    return;
                }

                const target = document.getElementById(href.substring(1));
                if (target) {
                    e.preventDefault();
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>

    <!-- AOS (Animate On Scroll) JS -->
    <script src="{% static 'js/aos.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Selective AOS: Disable only for critical card sections on mobile to prevent scrolling jump
            if (window.innerWidth <= 991) {
                const staticSelectors = [
                    '.hp-luoghi [data-aos]',
                    '.hp-opere-section [data-aos]',
                    '.hp-card-primary[data-aos]',
                    '.hp-card-secondary[data-aos]'
                ];
                staticSelectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach(el => {
                        el.removeAttribute('data-aos');
                        el.style.opacity = '1';
                        el.style.transform = 'none';
                    });
                });
            }

            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true,
                offset: 50,
                disable: false 
            });

            // Parallax effect for Hero Video and Background Quotes
            const heroVideo = document.querySelector('.videobg');
            const quotes = document.querySelectorAll('.bg-quote');
            
            if ((heroVideo || quotes.length > 0) && window.innerWidth > 991) {
                window.addEventListener('scroll', function () {
                    const scrollY = window.pageYOffset;
                    
                    // Video Parallax
                    if (heroVideo) {
                        heroVideo.style.transform = `translate(-50%, calc(-50% + ${scrollY * 0.4}px))`;
                    }
                    
                    // Quotes Parallax
                    quotes.forEach(quote => {
                        const speed = parseFloat(quote.getAttribute('data-parallax-speed')) || 0.1;
                        const rect = quote.parentElement.getBoundingClientRect();
                        if (rect.top < window.innerHeight && rect.bottom > 0) {
                            const offset = (window.innerHeight - rect.top) * speed;
                            const rotation = quote.style.transform.match(/rotate\(([^)]+)\)/)?.[0] || '';
                            quote.style.transform = `translateY(${offset}px) ${rotation}`;
                        }
                    });
                }, { passive: true });
            }
        });
    </script>

    {% block extra_scripts %}{% endblock %}
</body>

</html>